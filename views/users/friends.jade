doctype html
html(lang="de")
	head
		meta(charset="utf-8")
		title DCM – DSA Charakter Manager
		//link(rel="stylesheet", href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css")
		link(rel="stylesheet", href="//netdna.bootstrapcdn.com/bootswatch/3.1.1/spacelab/bootstrap.min.css")
		link(rel="stylesheet", href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css")
		script(src="//code.jquery.com/jquery.min.js")
		//script(src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js")
		script(src="/typeahead.bundle.min.js")
		style.
			.tt-dropdown-menu {
				padding: 0.5em 0;
				background-color: white;
				border: 1px solid gray;
				border-radius: 0.5em;
				margin-top: 0.2em;
				min-width: 200px;
				text-indent: 1em;
			}
			.tt-cursor {
				background-color: silver;
			}
			.twitter-typeahead {
				width: 100%;
			}
	body
		nav.navbar.navbar-default(role="navigation")
			.container-fluid
				.navbar-header
					button.navbar-toggle(type="button", data-toggle="collapse", data-target="#navbar-collapse-chars")
						span.sr-only Navigation
						span.icon-bar
						span.icon-bar
						span.icon-bar
					a.navbar-brand DCM
				#navbar-collapse-chars.collapse.navbar-collapse
					ul.nav.navbar-nav
						each __link in _Menu.left
							- var __isCurrent = __link.url === _Menu.currentURL;
							if __isCurrent
								li.active
									a=__link.title
							else
								li
									a(href=__link.url)=__link.title
					ul.nav.navbar-nav.navbar-right
						each __link in _Menu.right
							- var __isCurrent = __link.url === _Menu.currentURL;
							li
								a(href=__isCurrent ? null : __link.url, title=__link.title)
									span.hidden-xs(class=__link.sign.join(" ")) &nbsp;
									span.visible-xs=__link.title
		.container
			.page-header.text-center
				h1
					span.fa.fa-users &nbsp;
					|  Freunde
			.container
				h4 
					span.fa.fa-share-square-o
					|  Teile deine Helden mit anderen
				p Freunde können sich alle deine aktiven Helden anschauen. Das ist besonders dann nützlich, wenn ihr alle zusammen in einer Gruppe spielt – ein Browser, alle Helden.
				p Natürlich bleibst du der einzige, der seine Helden editieren darf.
				p &nbsp;
			.row
				.col-sm-6
					.panel.panel-default
						.panel-heading
							h4
								span.fa.fa-users &nbsp;
								span Meine Freunde
								span#friend-count.badge.pull-right=_User.friends.length
						.panel-body
							ul#friend-list.list-group
								each __friend in _Friends
									li.list-group-item
										label.checkbox-inline
											input(type="checkbox", name="friends[]", value=__friend._id, checked)
											|  #{__friend.local.name}

				.col-sm-6
					.panel.panel-default
						.panel-heading
							h4
								span.fa.fa-search &nbsp;
								span Freunde suchen
						.panel-body
							.form-group
								input#friend-add.username-search.form-control(type="text", placeholder="Suche nach Namen")
							.form-group.text-center
								button#empty.btn.btn-default Neue Suche
					.panel.panel-default
						.panel-heading
							h4
								span.fa.fa-bullhorn &nbsp;
								span Freundschaftsanfrage senden
								span.fa.fa-warning.text-danger
						.panel-body
							.form-group
								input#friend-ask.username-search.form-control(type="text", placeholder="Suche nach Namen", data-id)
							.form-group.text-center
								button#ask.btn.btn-default senden
					.panel.panel-default
						.panel-heading
							h4
								span.fa.fa-thumbs-o-up &nbsp;
								span Freundschaft bestätigen
								span.fa.fa-warning.text-danger
						.panel-body
							ul.list-group
								li.list-group-item
									label.checkbox-inline
										input(type="checkbox", value="ObjectID")
										span Max Mustermann
		script.
			function dropdownItem(obj) {
				return '<p><div>'+obj.name+'</div><div><small>'+obj.email+'</small></div></p>';
			}
			$('.username-search').typeahead({
				hint:      true,
				highlight: true,
				minLength: 2
			}, {
				name:      "usernames",
				displayKey: "name",
				templates: {
					empty: '<div>—kein Name gefunden—</div>',
					suggestion: dropdownItem,
				},
				source: function (q, cb) {
					$.getJSON("/userlist", { name: q }, cb);
				}
			});
			$('#friend-add').on("typeahead:selected", function(evt, selection, datasetName) {
				var $li = $('<li class="list-group-item"/>');
				var $label = $('<label class="checkbox-inline"/>');
				var $cbox = $('<input type="checkbox" name="friends[]"/>');
				$cbox.val(selection.id);
				$label.append($cbox).append(selection.name);
				$li.append($label);
				$('#friend-list').append($li);
			});
			$('#empty').on("click", function() {
				$('#username-search').val("");
			});
			$('#friend-list').on("click", 'input', function() {
				$.post( 
					"/freunde", 
					$('#friend-list').find(':checked').serialize() 
				).done(function(data) {
					$('#friend-count').text(data.count);
				});
			});